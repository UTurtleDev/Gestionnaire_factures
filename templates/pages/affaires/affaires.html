{% extends "base.html" %}
{% load static %}

{% block title %}Affaires{% endblock title %}

{% block content %}

<div class="title">
    <H2>Affaires ({{ affaires.paginator.count }})</H2>
    <div class="title_btn">
        <div class="new"><a href="{% url 'affaires:create' %}">+ Nouvelle affaire</a></div>
    </div>
</div>

<section class="tableau">
    <table class="table">
        <thead>
            <tr>
                <th>
                    <div class="th-div">
                        <span>NUMÉRO</span>
                        <span style="display: none">
                            <svg aria-hidden="true" focusable="false" data-prefix="fad" data-icon="sort-up" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512">
                                <g class="fa-group">
                                    <path fill="currentColor" d="M0 320c0 8.3 3.3 16.5 9.4 22.6l128 128c12.5 12.5 32.8 12.5 45.3 0l128-128c9.2-9.2 11.9-22.9 6.9-34.9s-16.6-19.8-29.6-19.8L32 288c-12.9 0-24.6 7.8-29.6 19.8C.8 311.7 0 315.9 0 320zm109.3 32l101.5 0L160 402.7 109.3 352z" class="fa-secondary">
                                    </path>
                                    <path fill="currentColor" d="M182.6 41.4c-12.5-12.5-32.8-12.5-45.3 0l-128 128c-9.2 9.2-11.9 22.9-6.9 34.9s16.6 19.8 29.6 19.8l256 0c12.9 0 24.6-7.8 29.6-19.8s2.2-25.7-6.9-34.9l-128-128z" class="fa-primary">
                                    </path>
                                </g>
                            </svg>
                        </span>
                    </div>
                </th>
                <th>
                    <div class="th-div">
                        <span>DÉSCRIPTION</span>
                    </div>
                </th>
                <th>
                    <div class="th-div">
                        <span>CLIENT</span>
                    </div>
                </th>
                <th>
                    <div class="th-div">
                        <span>BUDGET</span>
                    </div>
                </th>
                <th>
                    <div class="th-div">
                        <span>FACTURÉ</span>
                    </div>
                </th>
                <th>
                    <div class="th-div">
                        <span>A FACTURER</span>
                    </div>
                </th>
                <th>
                    <div class="th-div">
                    </div>
                </th>
            </tr>
        </thead>
        
        {% if affaires %}
        <tbody>
            {% for affaire in affaires %}
            <tr data-url="{% url 'affaires:detail' affaire.pk %}" class="clickable-row">
                <td colspan="1">
                    <div class="addresse">
                        <p>{{ affaire.affaire_number }}</p>
                    </div>
                </td>
                <td colspan="1">
                    <div class="addresse">
                        <p>{{ affaire.affaire_description }}</p>
                    </div>
                </td>
                <td colspan="1">
                    <div class="addresse">
                        <P>{{ affaire.client_entity_name }}</P>
                    </div>
                </td>
                <td colspan="1">
                    <div class="addresse">
                        <P>{{ affaire.formatted_budget }}</P>
                    </div>
                </td>
                <td colspan="1">
                    <div class="addresse">
                        <P>{{ affaire.formatted_total_facture_ht }}</P>
                    </div>
                </td>
                <td colspan="1">
                    <div class="addresse">
                        <p>{{ affaire.formatted_reste_a_facturer }}</p>
                    </div>
                </td>
                <td colspan="1">
                    <div class="actions-list">
                        {% if affaire.formatted_taux_avancement != '100 %' %}
                        <div class="pourcent">
                            {{ affaire.formatted_taux_avancement }}
                        </div>
                        {% else %}
                        <div class="cercle-vert"></div>
                        {% endif %}
                        <div class="actions">
                            <a href="{% url 'factures:create' %}?affaire={{ affaire.pk }}" title="Facturer">
                                <img class="param-img-svg" src="{% static 'img/facturer.svg' %}" alt="Facturer">
                            </a>
                        </div>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
        {% endif %}

    </table>
    <!-- Navigation de pagination -->
    <div class="pagination-container">
        
        <div class="pagination-nav">
            <!-- Bouton Précédent -->
            {% if affaires.has_previous %}
            <a href="?page=1" class="btn">«</a>
            {% endif %}
            
            <!-- Numéros de pages -->
            {% for num in affaires.paginator.page_range %}
            {% if affaires.number == num %}
            <span class="current-page">{{ num }}</span>
            {% else %}
            <a href="?page={{ num }}" class="btn">{{ num }}</a>
            {% endif %}
            {% endfor %}
            
            <!-- Bouton Suivant -->
            {% if affaires.has_next %}
            <a href="?page={{ affaires.paginator.num_pages }}" class="btn">»</a>
            {% endif %}
        </div>
        <div class="pagination-info">
            <p>
                Page {{ affaires.number }} sur {{ affaires.paginator.num_pages }}
            </p>
        </div>
    </div>
    

</section>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const clickableRows = document.querySelectorAll('.clickable-row');
        clickableRows.forEach(row => {
            row.addEventListener('click', function() {
                window.location = this.dataset.url;
            });
        });
    });
</script>



{% endblock content %}